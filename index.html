
<!DOCTYPE html>
<html>
<head>

	<title>UFNP Initial Test</title>

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="UNFP Map tests"
	<link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" />
<link href="simple-grid.css" rel="stylesheet" >
<script src="https://api.mapbox.com/mapbox-gl-js/v1.8.1/mapbox-gl.js"></script>
<link href="https://api.mapbox.com/mapbox-gl-js/v1.8.1/mapbox-gl.css" rel="stylesheet" />

</head>
<body>
	<div class="container">
		<main>
		<div class="row">
			<div class="col-3">
			</div>
			<div class="col-6">
				<div id="map"></div>
			</div>
			<div class="col-3">
			</div>
		</div>
	</main>
</div>




<script>
  mapboxgl.accessToken = "pk.eyJ1IjoidWZubWFwdGVzdCIsImEiOiJja2FybjQ0b2kwbzNoMnhwbG1oNnBwbzh6In0.IEdNzx7pvq0qiHAIZQckJw";
  var map = new mapboxgl.Map({
    container: "map",
		// TK this loaded style includes the dataset for filtering and location, and the map tile styling
    style: "mapbox://styles/ufnmaptest/ckb0e5f8q0o3e1il9tpcbvbp0",
// set location for start of this story, point to From Telephoto to Macro location
		center: [151.22,
          -33.83],
		zoom:11
  });
	//TK add fullscreen controls from https://docs.mapbox.com/mapbox-gl-js/example/fullscreen/
	// TK ideally would be able to control this to be large but not fullscreen, need to break column/margin assigned to col-6
	map.addControl(new mapboxgl.FullscreenControl());
	// TK add navigation control and move to top left
	var nav = new mapboxgl.NavigationControl();
	map.addControl(nav, "top-left");

// TK using principles from https://docs.mapbox.com/mapbox-gl-js/example/popup-on-hover/ and placeholder JSON I created


map.on('load', function() {
map.addSource('places', {
'type': 'geojson',
'data': {
'type': 'FeatureCollection',
'features': [
{ "type": "Feature",
      "properties": {
        "tags": "funny",
        "name": "Oar-Some Osprey",
        "location": "Opera Bar",
        "excerpt": "Lorem Ipsum",
        "storyFullText": "Lorem Ipsum",
        "coverImage": "Lorem Ipsum",
        "url": "https://urbanfieldnaturalist.org/stories/oar-some-osprey",
        "date": "01-01-2020",
        "storyAuthor": "Lorem Ipsum",
        "authorBio": "Lorem Ipsum"
      },
      "geometry": {
        "coordinates": [
          151.213852,
          -33.858318
        ],
        "type": "Point"
      },
      "id": "0564d9a1918093e567afb4fb7856745d"
    },
    {
      "type": "Feature",
      "properties": {
        "storyAuthor": "Lorem Ipsum",
        "excerpt": "Lorem Ipsum",
        "coverImage": "Lorem Ipsum",
        "name": "Sometimes Nature Comes to You",
        "date": "01-01-2020",
        "url": "https://urbanfieldnaturalist.org/stories/sometimes-nature-comes-to-you",
        "storyFullText": "Lorem Ipsum",
        "location": "Ivanhoe, Victoria, Australia",
        "tags": "curious",
        "wikidata": "Q3156237",
        "authorBio": "Lorem Ipsum"
      },
      "geometry": {
        "coordinates": [
          145.0457,
          -37.7703
        ],
        "type": "Point"
      },
      "id": "locality.14898022940438750"
    },
    {
      "type": "Feature",
      "properties": {
        "storyAuthor": "Lorem Ipsum",
        "excerpt": "Lorem Ipsum",
        "coverImage": "Lorem Ipsum",
        "name": "From Telephoto to Macro, the Big Side of a Small World",
        "date": "01-01-2020",
        "url": "https://urbanfieldnaturalist.org/stories/telephoto-to-macro",
        "storyFullText": "Lorem Ipsum",
        "location": "Cammeray, New South Wales, Australia",
        "tags": "funny",
        "wikidata": "Q5026863",
        "authorBio": "Lorem Ipsum"
      },
      "geometry": {
        "coordinates": [
          151.22,
          -33.8231
        ],
        "type": "Point"
      },
      "id": "locality.1832825270203500"
    },
    {
      "type": "Feature",
      "properties": {
        "storyAuthor": "Lorem Ipsum",
        "excerpt": "Lorem Ipsum",
        "coverImage": "Lorem Ipsum",
        "name": "Not Really Friends",
        "date": "01-01-2020",
        "url": "https://urbanfieldnaturalist.org/stories/not-really-friends",
        "storyFullText": "Lorem Ipsum",
        "location": "Fitzroy, Victoria, Australia",
        "tags": "funny",
        "wikidata": "Q1421389",
        "authorBio": "Lorem Ipsum"
      },
      "geometry": {
        "coordinates": [
          144.979,
          -37.8011
        ],
        "type": "Point"
      },
      "id": "locality.3311283460220480"
    },
    {
      "type": "Feature",
      "properties": {
        "storyAuthor": "Lorem Ipsum",
        "excerpt": "Lorem Ipsum",
        "coverImage": "Lorem Ipsum",
        "name": "Welcoming a Change",
        "date": "01-01-2020",
        "url": "https://urbanfieldnaturalist.org/stories/welcoming-a-change",
        "storyFullText": "Lorem Ipsum",
        "location": "Rozelle, New South Wales, Australia",
        "tags": "joyful",
        "wikidata": "Q6270986",
        "authorBio": "Lorem Ipsum"
      },
      "geometry": {
        "coordinates": [
          151.167,
          -33.8649
        ],
        "type": "Point"
      },
      "id": "locality.5966651846933350"
    },
    {
      "type": "Feature",
      "properties": {
        "storyAuthor": "Lorem Ipsum",
        "excerpt": "Lorem Ipsum",
        "coverImage": "Lorem Ipsum",
        "name": "A Stunning Aussie Bee",
        "date": "01-01-2020",
        "url": "https://urbanfieldnaturalist.org/stories/a-stunning-aussie-bee",
        "storyFullText": "Lorem Ipsum",
        "location": "Drummoyne, New South Wales, Australia",
        "tags": "curious",
        "wikidata": "Q5309255",
        "authorBio": "Lorem Ipsum"
      },
      "geometry": {
        "coordinates": [
          151.154,
          -33.8535
        ],
        "type": "Point"
      },
      "id": "locality.8869668159147530"
    },
    {
      "type": "Feature",
      "properties": {
        "storyAuthor": "Lorem Ipsum",
        "excerpt": "Lorem Ipsum",
        "coverImage": "Lorem Ipsum",
        "name": "Scrumptious Scats, Seriously",
        "date": "01-01-2020",
        "url": "https://urbanfieldnaturalist.org/stories/scrumptious-scats",
        "storyFullText": "Lorem Ipsum",
        "location": "Blue Mountains, New South Wales, Australia",
        "tags": "curious",
        "wikidata": "Q667529",
        "authorBio": "Lorem Ipsum"
      },
      "geometry": {
        "coordinates": [
          150.38,
          -33.71
        ],
        "type": "Point"
      },
      "id": "place.2697685586399870"
		}
}
]
})
});
// TK rest of code adapted straight from https://docs.mapbox.com/mapbox-gl-js/example/popup-on-hover/
// Add a layer showing the places.
map.addLayer({
'id': 'places',
'type': 'symbol',
'source': 'places',
'layout': {
'icon-image': '{icon}-15',
'icon-allow-overlap': true
}
});

// Create a popup, but don't add it to the map yet.
var popup = new mapboxgl.Popup({
closeButton: false,
closeOnClick: false
});

map.on('mouseenter', 'places', function(e) {
// Change the cursor style as a UI indicator.
map.getCanvas().style.cursor = 'pointer';

var coordinates = e.features[0].geometry.coordinates.slice();
var description = e.features[0].properties.name;

// Ensure that if the map is zoomed out such that multiple
// copies of the feature are visible, the popup appears
// over the copy being pointed to.
while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {
coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;
}

// Populate the popup and set its coordinates
// based on the feature found.
popup
.setLngLat(coordinates)
.setHTML(name)
.addTo(map);
});

map.on('mouseleave', 'places', function() {
map.getCanvas().style.cursor = '';
popup.remove();
});
});


	// TK add popup onClick using https://docs.mapbox.com/help/tutorials/add-points-pt-3/ DID NOT WORK
// 	map.on('click', function(e) {
//   var features = map.queryRenderedFeatures(e.point, {
// 		// dataset layer name in studio builder
//     layers: ['story-icons']
//
//   });
//
//   if (!features.length) {
//     return;
//   }
//
//   var feature = features[0];
//
//   var popup = new mapboxgl.Popup({ offset: [0, -15] })
//     .setLngLat(feature.geometry.coordinates)
//     .setHTML('<h3>' + feature.properties.name + '</h3><p>' + feature.properties.url + '</p>')
//     .addTo(map);
// });
</script>

</body>
</html>
